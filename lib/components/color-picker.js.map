{"version":3,"file":"color-picker.js","sourceRoot":"","sources":["../../src/lib/components/color-picker.ts"],"names":[],"mappings":"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","sourcesContent":["import { equalColorObjects } from '../utils/compare.js';\r\nimport { fire, render } from '../utils/dom.js';\r\nimport type { AnyColor, ColorModel, HsvaColor } from '../types';\r\nimport { Hue } from './hue.js';\r\nimport { Saturation } from './saturation.js';\r\nimport type { Slider } from './slider.js';\r\nimport css from '../styles/color-picker.js';\r\nimport hueCss from '../styles/hue.js';\r\nimport saturationCss from '../styles/saturation.js';\r\n\r\nconst $isSame = Symbol('same');\r\nconst $color = Symbol('color');\r\nconst $hsva = Symbol('hsva');\r\nconst $update = Symbol('update');\r\nconst $parts = Symbol('parts');\r\n\r\nexport const $css = Symbol('css');\r\nexport const $sliders = Symbol('sliders');\r\n\r\nexport type Sliders = Array<new (root: ShadowRoot) => Slider>;\r\n\r\nexport abstract class ColorPicker<C extends AnyColor> extends HTMLElement {\r\n  static get observedAttributes(): string[] {\r\n    return ['color'];\r\n  }\r\n\r\n  protected get [$css](): string[] {\r\n    return [css, hueCss, saturationCss];\r\n  }\r\n\r\n  protected get [$sliders](): Sliders {\r\n    return [Saturation, Hue];\r\n  }\r\n\r\n  protected abstract get colorModel(): ColorModel<C>;\r\n\r\n  private declare [$hsva]: HsvaColor;\r\n\r\n  private declare [$color]: C;\r\n\r\n  private declare [$parts]: Slider[];\r\n\r\n  get color(): C {\r\n    return this[$color];\r\n  }\r\n\r\n  set color(newColor: C) {\r\n    if (!this[$isSame](newColor)) {\r\n      const newHsva = this.colorModel.toHsva(newColor);\r\n      this[$update](newHsva);\r\n      this[$color] = newColor;\r\n    }\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n    const root = this.attachShadow({ mode: 'open' });\r\n    render(root, `<style>${this[$css].join('')}</style>`);\r\n    root.addEventListener('move', this);\r\n    this[$parts] = this[$sliders].map((slider) => new slider(root));\r\n  }\r\n\r\n  connectedCallback(): void {\r\n    // A user may set a property on an _instance_ of an element,\r\n    // before its prototype has been connected to this class.\r\n    // If so, we need to run it through the proper class setter.\r\n    if (this.hasOwnProperty('color')) {\r\n      const value = this.color;\r\n      delete this['color' as keyof this];\r\n      this.color = value;\r\n    } else if (!this.color) {\r\n      this.color = this.colorModel.defaultColor;\r\n    }\r\n  }\r\n\r\n  attributeChangedCallback(_attr: string, _oldVal: string, newVal: string): void {\r\n    const color = this.colorModel.fromAttr(newVal);\r\n    if (!this[$isSame](color)) {\r\n      this.color = color;\r\n    }\r\n  }\r\n\r\n  handleEvent(event: CustomEvent): void {\r\n    // Merge the current HSV color object with updated params.\r\n    const oldHsva = this[$hsva];\r\n    const newHsva = { ...oldHsva, ...event.detail };\r\n    this[$update](newHsva);\r\n    let newColor;\r\n    if (\r\n      !equalColorObjects(newHsva, oldHsva) &&\r\n      !this[$isSame]((newColor = this.colorModel.fromHsva(newHsva)))\r\n    ) {\r\n      this[$color] = newColor;\r\n      fire(this, 'color-changed', { value: newColor });\r\n    }\r\n  }\r\n\r\n  private [$isSame](color: C): boolean {\r\n    return this.color && this.colorModel.equal(color, this.color);\r\n  }\r\n\r\n  private [$update](hsva: HsvaColor): void {\r\n    this[$hsva] = hsva;\r\n    this[$parts].forEach((part) => part.update(hsva));\r\n  }\r\n}\r\n"]}