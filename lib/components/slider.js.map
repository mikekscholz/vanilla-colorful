{"version":3,"file":"slider.js","sourceRoot":"","sources":["../../src/lib/components/slider.ts"],"names":[],"mappings":"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","sourcesContent":["import type { HsvaColor } from '../types.js';\r\nimport { fire, render } from '../utils/dom.js';\r\nimport { clamp } from '../utils/math.js';\r\n\r\nexport interface Offset {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nlet hasTouched = false;\r\n\r\n// Check if an event was triggered by touch\r\nconst isTouch = (e: Event): e is TouchEvent => 'touches' in e;\r\n\r\n// Prevent mobile browsers from handling mouse events (conflicting with touch ones).\r\n// If we detected a touch interaction before, we prefer reacting to touch events only.\r\nconst isValid = (event: Event): boolean => {\r\n  if (hasTouched && !isTouch(event)) return false;\r\n  if (!hasTouched) hasTouched = isTouch(event);\r\n  return true;\r\n};\r\n\r\nconst pointerMove = (target: Slider, event: Event): void => {\r\n  const pointer = isTouch(event) ? event.touches[0] : (event as MouseEvent);\r\n  const rect = target.el.getBoundingClientRect();\r\n\r\n  fire(\r\n    target.el,\r\n    'move',\r\n    target.getMove({\r\n      x: clamp((pointer.pageX - (rect.left + window.pageXOffset)) / rect.width),\r\n      y: clamp((pointer.pageY - (rect.top + window.pageYOffset)) / rect.height)\r\n    })\r\n  );\r\n};\r\n\r\nconst keyMove = (target: Slider, event: KeyboardEvent): void => {\r\n  // We use `keyCode` instead of `key` to reduce the size of the library.\r\n  const keyCode = event.keyCode;\r\n  // Ignore all keys except arrow ones, Page Up, Page Down, Home and End.\r\n  if (keyCode > 40 || (target.xy && keyCode < 37) || keyCode < 33) return;\r\n  // Do not scroll page by keys when color picker element has focus.\r\n  event.preventDefault();\r\n  // Send relative offset to the parent component.\r\n  fire(\r\n    target.el,\r\n    'move',\r\n    target.getMove(\r\n      {\r\n        x:\r\n          keyCode === 39 // Arrow Right\r\n            ? 0.01\r\n            : keyCode === 37 // Arrow Left\r\n            ? -0.01\r\n            : keyCode === 34 // Page Down\r\n            ? 0.05\r\n            : keyCode === 33 // Page Up\r\n            ? -0.05\r\n            : keyCode === 35 // End\r\n            ? 1\r\n            : keyCode === 36 // Home\r\n            ? -1\r\n            : 0,\r\n        y:\r\n          keyCode === 40 // Arrow down\r\n            ? 0.01\r\n            : keyCode === 38 // Arrow Up\r\n            ? -0.01\r\n            : 0\r\n      },\r\n      true\r\n    )\r\n  );\r\n};\r\n\r\nexport abstract class Slider {\r\n  declare nodes: HTMLElement[];\r\n\r\n  declare el: HTMLElement;\r\n\r\n  declare xy: boolean;\r\n\r\n  constructor(root: ShadowRoot, part: string, aria: string, xy: boolean) {\r\n    render(\r\n      root,\r\n      `<div role=\"slider\" tabindex=\"0\" part=\"${part}\" ${aria}><div part=\"${part}-pointer\"></div></div>`\r\n    );\r\n\r\n    const el = root.querySelector(`[part=${part}]`) as HTMLElement;\r\n    el.addEventListener('mousedown', this);\r\n    el.addEventListener('touchstart', this);\r\n    el.addEventListener('keydown', this);\r\n    this.el = el;\r\n\r\n    this.xy = xy;\r\n    this.nodes = [el.firstChild as HTMLElement, el];\r\n  }\r\n\r\n  set dragging(state: boolean) {\r\n    const toggleEvent = state ? document.addEventListener : document.removeEventListener;\r\n    toggleEvent(hasTouched ? 'touchmove' : 'mousemove', this);\r\n    toggleEvent(hasTouched ? 'touchend' : 'mouseup', this);\r\n  }\r\n\r\n  handleEvent(event: Event): void {\r\n    switch (event.type) {\r\n      case 'mousedown':\r\n      case 'touchstart':\r\n        event.preventDefault();\r\n        // event.button is 0 in mousedown for left button activation\r\n        if (!isValid(event) || (!hasTouched && (event as MouseEvent).button != 0)) return;\r\n        this.el.focus();\r\n        pointerMove(this, event);\r\n        this.dragging = true;\r\n        break;\r\n      case 'mousemove':\r\n      case 'touchmove':\r\n        event.preventDefault();\r\n        pointerMove(this, event);\r\n        break;\r\n      case 'mouseup':\r\n      case 'touchend':\r\n        this.dragging = false;\r\n        break;\r\n      case 'keydown':\r\n        keyMove(this, event as KeyboardEvent);\r\n        break;\r\n    }\r\n  }\r\n\r\n  abstract getMove(offset: Offset, key?: boolean): Record<string, number>;\r\n\r\n  abstract update(hsva: HsvaColor): void;\r\n\r\n  style(styles: Array<Record<string, string>>): void {\r\n    styles.forEach((style, i) => {\r\n      for (const p in style) {\r\n        this.nodes[i].style.setProperty(p, style[p]);\r\n      }\r\n    });\r\n  }\r\n}\r\n"]}