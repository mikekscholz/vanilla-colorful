{"version":3,"file":"hex-input.js","sourceRoot":"","sources":["../../src/lib/entrypoints/hex-input.ts"],"names":[],"mappings":"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","sourcesContent":["import type { ColorPickerEventListener, ColorPickerEventMap } from '../types';\r\nimport { validHex } from '../utils/validate.js';\r\nimport { render } from '../utils/dom.js';\r\n\r\n// Escapes all non-hexadecimal characters including \"#\"\r\nconst escape = (hex: string, alpha: boolean) =>\r\n  hex.replace(/([^0-9A-F]+)/gi, '').substring(0, alpha ? 8 : 6);\r\n\r\nconst $alpha = Symbol('alpha');\r\nconst $color = Symbol('color');\r\nconst $saved = Symbol('saved');\r\nconst $input = Symbol('input');\r\nconst $init = Symbol('init');\r\nconst $prefix = Symbol('prefix');\r\nconst $update = Symbol('update');\r\n\r\nexport interface HexInputBase {\r\n  addEventListener<T extends keyof ColorPickerEventMap<string>>(\r\n    type: T,\r\n    listener: ColorPickerEventListener<ColorPickerEventMap<string>[T]>,\r\n    options?: boolean | AddEventListenerOptions\r\n  ): void;\r\n\r\n  removeEventListener<T extends keyof ColorPickerEventMap<string>>(\r\n    type: T,\r\n    listener: ColorPickerEventListener<ColorPickerEventMap<string>[T]>,\r\n    options?: boolean | EventListenerOptions\r\n  ): void;\r\n}\r\n\r\nexport class HexInputBase extends HTMLElement {\r\n  static get observedAttributes(): string[] {\r\n    return ['alpha', 'color', 'prefixed'];\r\n  }\r\n\r\n  private declare [$color]: string;\r\n\r\n  private declare [$alpha]: boolean;\r\n\r\n  private declare [$prefix]: boolean;\r\n\r\n  private declare [$saved]: string;\r\n\r\n  private declare [$input]: HTMLInputElement;\r\n\r\n  get color(): string {\r\n    return this[$color];\r\n  }\r\n\r\n  set color(hex: string) {\r\n    this[$color] = hex;\r\n    this[$update](hex);\r\n  }\r\n\r\n  get alpha(): boolean {\r\n    return this[$alpha];\r\n  }\r\n\r\n  set alpha(alpha: boolean) {\r\n    this[$alpha] = alpha;\r\n    this.toggleAttribute('alpha', alpha);\r\n\r\n    // When alpha set to false, update color\r\n    const color = this.color;\r\n    if (color && !validHex(color, alpha)) {\r\n      this.color = color.startsWith('#')\r\n        ? color.substring(0, color.length === 5 ? 4 : 7)\r\n        : color.substring(0, color.length === 4 ? 3 : 6);\r\n    }\r\n  }\r\n\r\n  get prefixed(): boolean {\r\n    return this[$prefix];\r\n  }\r\n\r\n  set prefixed(prefixed: boolean) {\r\n    this[$prefix] = prefixed;\r\n    this.toggleAttribute('prefixed', prefixed);\r\n    this[$update](this.color);\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    const root = this.attachShadow({ mode: 'open' });\r\n    render(root, '<slot><input part=\"input\" spellcheck=\"false\"></slot>');\r\n    const slot = root.firstElementChild as HTMLSlotElement;\r\n    slot.addEventListener('slotchange', () => this[$init](root));\r\n  }\r\n\r\n  connectedCallback(): void {\r\n    this[$init](this.shadowRoot as ShadowRoot);\r\n\r\n    // A user may set a property on an _instance_ of an element,\r\n    // before its prototype has been connected to this class.\r\n    // If so, we need to run it through the proper class setter.\r\n    if (this.hasOwnProperty('alpha')) {\r\n      const value = this.alpha;\r\n      delete this['alpha' as keyof this];\r\n      this.alpha = value;\r\n    } else {\r\n      this.alpha = this.hasAttribute('alpha');\r\n    }\r\n\r\n    if (this.hasOwnProperty('prefixed')) {\r\n      const value = this.prefixed;\r\n      delete this['prefixed' as keyof this];\r\n      this.prefixed = value;\r\n    } else {\r\n      this.prefixed = this.hasAttribute('prefixed');\r\n    }\r\n\r\n    if (this.hasOwnProperty('color')) {\r\n      const value = this.color;\r\n      delete this['color' as keyof this];\r\n      this.color = value;\r\n    } else if (this.color == null) {\r\n      this.color = this.getAttribute('color') || '';\r\n    } else if (this[$color]) {\r\n      this[$update](this[$color]);\r\n    }\r\n  }\r\n\r\n  handleEvent(event: Event): void {\r\n    const target = event.target as HTMLInputElement;\r\n    const { value } = target;\r\n    switch (event.type) {\r\n      case 'input':\r\n        const hex = escape(value, this.alpha);\r\n        this[$saved] = this.color;\r\n        if (validHex(hex, this.alpha) || value === '') {\r\n          this.color = hex;\r\n          this.dispatchEvent(\r\n            new CustomEvent('color-changed', {\r\n              bubbles: true,\r\n              detail: { value: hex ? '#' + hex : '' }\r\n            })\r\n          );\r\n        }\r\n        break;\r\n      case 'blur':\r\n        if (value && !validHex(value, this.alpha)) {\r\n          this.color = this[$saved];\r\n        }\r\n    }\r\n  }\r\n\r\n  attributeChangedCallback(attr: string, _oldVal: string, newVal: string): void {\r\n    if (attr === 'color' && this.color !== newVal) {\r\n      this.color = newVal;\r\n    }\r\n\r\n    const hasBooleanAttr = newVal != null;\r\n    if (attr === 'alpha') {\r\n      if (this.alpha !== hasBooleanAttr) {\r\n        this.alpha = hasBooleanAttr;\r\n      }\r\n    }\r\n\r\n    if (attr === 'prefixed') {\r\n      if (this.prefixed !== hasBooleanAttr) {\r\n        this.prefixed = hasBooleanAttr;\r\n      }\r\n    }\r\n  }\r\n\r\n  private [$init](root: ShadowRoot): void {\r\n    let input = this.querySelector('input');\r\n    if (!input) {\r\n      // remove all child node if no input found\r\n      let c;\r\n      while ((c = this.firstChild)) {\r\n        c.remove();\r\n      }\r\n\r\n      input = root.querySelector('input') as HTMLInputElement;\r\n    }\r\n    input.addEventListener('input', this);\r\n    input.addEventListener('blur', this);\r\n    this[$input] = input;\r\n    this[$update](this.color);\r\n  }\r\n\r\n  private [$update](hex: string): void {\r\n    if (this[$input]) {\r\n      this[$input].value =\r\n        hex == null || hex == '' ? '' : (this.prefixed ? '#' : '') + escape(hex, this.alpha);\r\n    }\r\n  }\r\n}\r\n"]}